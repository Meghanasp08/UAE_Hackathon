<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Credit Line Controls</title>
  <link rel="stylesheet" href="css/style.css"/>
  <link rel="stylesheet" href="css/auto-sweep-benefits.css"/>
  <link rel="stylesheet" href="css/term-loan.css"/>
</head>
<body>
  <header class="topbar">
    <div class="brand">
      <img src="assets/shukria-logo.png" alt="Shukria Logo" class="logo" onerror="this.style.display='none'"/>
    </div>
    <nav class="nav-links">
      <a href="index.html" class="nav-link" title="Dashboard" aria-label="Dashboard">
        <img src="assets/nav-dashboard.svg" alt="Dashboard" style="height:28px;width:28px;vertical-align:middle;"/>
      </a>
      <a href="credit-line.html" class="nav-link active" title="Credit Line" aria-label="Credit Line">
        <img src="assets/nav-credit-line.svg" alt="Credit Line" style="height:28px;width:28px;vertical-align:middle;"/>
      </a>
      <a href="apply.html" class="nav-link" title="Apply" aria-label="Apply">
        <img src="assets/nav-apply.svg" alt="Apply" style="height:28px;width:28px;vertical-align:middle;"/>
      </a>
      <a href="transactions.html" class="nav-link" title="Transactions" aria-label="Transactions">
        <img src="assets/nav-transactions.svg" alt="Transactions" style="height:28px;width:28px;vertical-align:middle;"/>
      </a>
    </nav>
    <div class="user">Hello, Meghana</div>
  </header>
  </header>

  <main class="container">
    <section class="credit-header">
      <h2>Your Credit Line</h2>
    </section>

    <!-- Credit Line Summary -->
    <div class="credit-summary-card">
      <div class="credit-visual">
        <svg viewBox="0 0 200 200" class="credit-circle">
          <circle cx="100" cy="100" r="90" fill="none" stroke="#e5e7eb" stroke-width="20"/>
          <circle cx="100" cy="100" r="90" fill="none" stroke="#0f6ef3" stroke-width="20" 
                  stroke-dasharray="565.48" stroke-dashoffset="452.38" stroke-linecap="round"
                  transform="rotate(-90 100 100)" id="creditUsageCircle"/>
          <text x="100" y="95" text-anchor="middle" font-size="24" font-weight="bold" fill="#111">18%</text>
          <text x="100" y="115" text-anchor="middle" font-size="12" fill="#6b7280">Used</text>
        </svg>
      </div>
      <div class="credit-details">
        <div class="credit-row">
          <span class="credit-label">Total Credit Limit</span>
          <span class="credit-value">AED 15,250</span>
        </div>
        <div class="credit-row">
          <span class="credit-label">Available Credit</span>
          <span class="credit-value highlight">AED 12,500</span>
        </div>
        <div class="credit-row">
          <span class="credit-label">Used</span>
          <span class="credit-value">AED 2,750</span>
        </div>
        <div class="credit-row">
          <span class="credit-label">Interest Rate (APR)</span>
          <span class="credit-value">8.9%</span>
        </div>
        <div class="credit-row">
          <span class="credit-label">Pay-as-you-go Fee</span>
          <span class="credit-value">0.5% per transaction</span>
        </div>
      </div>
    </div>

    <!-- Quick Actions -->
    <section class="credit-actions">
      <button class="action-btn primary" id="withdrawBtn">
        <span class="btn-icon">üí∞</span>
        <span>Withdraw</span>
      </button>
      <button class="action-btn secondary" id="repayBtn">
        <span class="btn-icon">‚Ü©Ô∏è</span>
        <span>Repay</span>
      </button>
      <button class="action-btn secondary" id="transferBtn">
        <span class="btn-icon">üîÑ</span>
        <span>Transfer to Account</span>
      </button>
      <button class="action-btn tertiary" id="termLoanBtn">
        <span class="btn-icon">üìä</span>
        <span>Term Loan</span>
      </button>
    </section>

    <!-- SmartPay Rules -->
    <section class="smartpay-section">
      <div class="section-header">
        <h3>SmartPay Automation Rules</h3>
        <button class="btn-primary small" id="addRuleBtn">+ Add Rule</button>
      </div>

      <div class="auto-sweep-card">
        <div class="sweep-header">
          <div>
            <h4>‚ö° Auto-Sweep</h4>
            <p>Automatically repay credit when your account balance exceeds threshold</p>
          </div>
          <label class="toggle-switch">
            <input type="checkbox" id="autoSweepToggle"/>
            <span class="toggle-slider"></span>
          </label>
        </div>
        <div id="sweepSettings" class="sweep-settings" hidden>
          <div class="setting-row">
            <label>Trigger when balance exceeds</label>
            <input type="number" id="sweepThreshold" value="5000" placeholder="5000"/>
            <span>AED</span>
          </div>
          <div class="setting-row">
            <label>Sweep schedule</label>
            <select id="sweepSchedule">
              <option value="immediate">Immediate</option>
              <option value="daily">Daily at 9 AM</option>
              <option value="weekly">Weekly (Monday)</option>
            </select>
          </div>
          <button class="btn-outline small" id="saveSweepSettings">Save Settings</button>
        </div>
        
        <!-- Auto-sweep Benefits Section -->
        <div class="sweep-benefits" id="sweepBenefits" style="display:none;">
          <h4>üí° Smart Auto-Sweep Benefits</h4>
          <div class="benefits-grid">
            <div class="benefit-card">
              <span class="benefit-icon">üí∞</span>
              <h5>Interest Saved (Monthly)</h5>
              <p class="benefit-value" id="interestSaved">AED 0</p>
              <span class="benefit-trend positive" id="interestTrend">‚Üó Projected 12% annual savings</span>
            </div>
            <div class="benefit-card">
              <span class="benefit-icon">‚ö°</span>
              <h5>Auto-Payments Made</h5>
              <p class="benefit-value" id="autoPayments">0</p>
              <span class="benefit-meta">Last 30 days</span>
            </div>
            <div class="benefit-card">
              <span class="benefit-icon">‚è±Ô∏è</span>
              <h5>Time Saved</h5>
              <p class="benefit-value" id="timeSaved">0 hrs</p>
              <span class="benefit-meta">Manual payment time saved</span>
            </div>
            <div class="benefit-card">
              <span class="benefit-icon">üìà</span>
              <h5>Cash Efficiency</h5>
              <p class="benefit-value" id="cashEfficiency">0%</p>
              <span class="benefit-meta">Improved cash utilization</span>
            </div>
          </div>
          <div class="benefits-summary">
            <h5>Smart Management Summary</h5>
            <ul class="benefits-list" id="benefitsList">
              <!-- Dynamically populated -->
            </ul>
          </div>
        </div>
      </div>

      <!-- Rules List -->
      <div id="rulesList" class="rules-list">
        <div class="rule-card">
          <div class="rule-header">
            <div class="rule-info">
              <h4>Monthly Auto-Repay</h4>
              <span class="rule-status active">Active</span>
            </div>
            <div class="rule-actions">
              <button class="btn-icon" aria-label="Edit rule">‚úèÔ∏è</button>
              <button class="btn-icon" aria-label="Delete rule">üóëÔ∏è</button>
            </div>
          </div>
          <div class="rule-body">
            <p><strong>Trigger:</strong> 1st of every month at 10:00 AM</p>
            <p><strong>Action:</strong> Repay 50% of outstanding balance</p>
            <p><strong>Last executed:</strong> Nov 1, 2025</p>
          </div>
        </div>

        <div class="rule-card">
          <div class="rule-header">
            <div class="rule-info">
              <h4>High Balance Transfer</h4>
              <span class="rule-status active">Active</span>
            </div>
            <div class="rule-actions">
              <button class="btn-icon" aria-label="Edit rule">‚úèÔ∏è</button>
              <button class="btn-icon" aria-label="Delete rule">üóëÔ∏è</button>
            </div>
          </div>
          <div class="rule-body">
            <p><strong>Trigger:</strong> When checking account balance > AED 10,000</p>
            <p><strong>Action:</strong> Transfer excess to savings (keep AED 8,000 buffer)</p>
            <p><strong>Last executed:</strong> Nov 3, 2025</p>
          </div>
        </div>
      </div>
    </section>

    <!-- Recent Rule Activity -->
    <section class="rule-activity">
      <h3>Recent Rule Executions</h3>
      <div class="activity-list">
        <div class="activity-item">
          <span class="activity-icon success">‚úì</span>
          <div class="activity-content">
            <p><strong>Monthly Auto-Repay</strong> executed successfully</p>
            <span class="activity-meta">Repaid AED 1,375 ¬∑ Nov 1, 2025 10:00 AM</span>
          </div>
        </div>
        <div class="activity-item">
          <span class="activity-icon success">‚úì</span>
          <div class="activity-content">
            <p><strong>High Balance Transfer</strong> executed successfully</p>
            <span class="activity-meta">Transferred AED 2,000 to savings ¬∑ Nov 3, 2025 3:45 PM</span>
          </div>
        </div>
      </div>
    </section>
  </main>

  <!-- Floating voice button -->
  <button id="voiceBtn" class="voice-btn" aria-label="Activate voice commands" title="Voice commands">
    üé§
  </button>

  <!-- Voice feedback live region -->
  <div id="voiceFeedback" class="sr-only" role="status" aria-live="polite" aria-atomic="true"></div>

  <!-- Add Rule Modal -->
  <div id="ruleModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="ruleModalTitle" hidden>
    <div class="modal-content large">
      <div class="modal-header">
        <h3 id="ruleModalTitle">Create SmartPay Rule</h3>
        <button class="modal-close" aria-label="Close modal">&times;</button>
      </div>
      <div class="modal-body">
        <form id="ruleForm">
          <div class="form-group">
            <label for="ruleName">Rule Name *</label>
            <input type="text" id="ruleName" required placeholder="e.g., Weekend Repayment"/>
          </div>

          <div class="form-group">
            <label>Trigger Condition *</label>
            <select id="triggerType" required>
              <option value="">Select trigger type</option>
              <option value="balance">Account balance threshold</option>
              <option value="credit">Credit usage threshold</option>
              <option value="schedule">Scheduled time</option>
              <option value="transaction">On transaction</option>
            </select>
          </div>

          <div id="triggerDetails" class="form-group" hidden>
            <!-- Dynamic based on trigger type -->
          </div>

          <div class="form-group">
            <label>Action *</label>
            <select id="actionType" required>
              <option value="">Select action</option>
              <option value="repay">Repay credit</option>
              <option value="transfer">Transfer to savings</option>
              <option value="limit">Adjust credit limit</option>
            </select>
          </div>

          <div id="actionDetails" class="form-group" hidden>
            <!-- Dynamic based on action type -->
          </div>

          <div class="form-group">
            <label>Priority</label>
            <select id="rulePriority">
              <option value="low">Low</option>
              <option value="medium" selected>Medium</option>
              <option value="high">High</option>
            </select>
          </div>

          <div class="form-actions">
            <button type="submit" class="btn-primary">Create Rule</button>
            <button type="button" class="btn-outline" id="cancelRule">Cancel</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Transaction Modal -->
  <div id="transactionModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="transactionTitle" hidden>
    <div class="modal-content">
      <div class="modal-header">
        <h3 id="transactionTitle">Quick Transaction</h3>
        <button class="modal-close" aria-label="Close modal">&times;</button>
      </div>
      <div class="modal-body">
        <form id="transactionForm">
          <div class="form-group">
            <label for="transactionAmount">Amount (AED) *</label>
            <input type="number" id="transactionAmount" required min="1" step="0.01" placeholder="500"/>
          </div>
          <div class="form-group" id="transactionNoteGroup">
            <label for="transactionNote">Note</label>
            <input type="text" id="transactionNote" placeholder="Optional note"/>
          </div>
          <div class="form-actions">
            <button type="submit" class="btn-primary" id="confirmTransaction">Confirm</button>
            <button type="button" class="btn-outline" id="cancelTransaction">Cancel</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Term Loan Modal -->
  <div id="termLoanModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="termLoanTitle" hidden>
    <div class="modal-content large">
      <div class="modal-header">
        <h3 id="termLoanTitle">Term Loan Application</h3>
        <button class="modal-close" aria-label="Close modal">&times;</button>
      </div>
      <div class="modal-body">
        
        <!-- Step Progress -->
        <div class="step-progress">
          <div class="step active" id="step1">
            <span class="step-number">1</span>
            <span class="step-label">Eligibility</span>
          </div>
          <div class="step" id="step2">
            <span class="step-number">2</span>
            <span class="step-label">Calculator</span>
          </div>
          <div class="step" id="step3">
            <span class="step-number">3</span>
            <span class="step-label">Confirmation</span>
          </div>
        </div>

        <!-- Step 1: Eligibility Check -->
        <div id="eligibilityStep" class="term-loan-step active">
          <h4>Check Your Eligibility</h4>
          <div id="eligibilityResult" class="eligibility-result">
            <div class="loading-spinner" id="eligibilityLoading">Checking eligibility...</div>
          </div>
        </div>

        <!-- Step 2: Loan Calculator -->
        <div id="calculatorStep" class="term-loan-step" hidden>
          <h4>Calculate Your Term Loan</h4>
          <div class="calculator-form">
            <div class="form-group">
              <label for="loanAmount">Loan Amount (AED)</label>
              <input type="number" id="loanAmount" min="1000" step="100" placeholder="Enter amount"/>
              <span class="field-note" id="amountNote">Minimum: AED 1,000</span>
            </div>
            
            <div class="form-group">
              <label for="loanTerm">Loan Term</label>
              <select id="loanTerm">
                <option value="">Select term</option>
                <option value="12">12 months (8.0% APR)</option>
                <option value="24">24 months (9.5% APR)</option>
                <option value="36">36 months (11.0% APR)</option>
                <option value="48">48 months (12.5% APR)</option>
                <option value="60">60 months (14.0% APR)</option>
              </select>
            </div>

            <button type="button" class="btn-primary" id="calculateLoan">Calculate</button>
          </div>

          <div id="loanResults" class="loan-results" hidden>
            <div class="results-grid">
              <div class="result-item">
                <span class="result-label">Monthly Payment (EMI)</span>
                <span class="result-value" id="monthlyEmi">AED 0</span>
              </div>
              <div class="result-item">
                <span class="result-label">Total Interest</span>
                <span class="result-value" id="totalInterest">AED 0</span>
              </div>
              <div class="result-item">
                <span class="result-label">Processing Fee (2.5%)</span>
                <span class="result-value" id="processingFee">AED 0</span>
              </div>
              <div class="result-item highlight">
                <span class="result-label">Total Cost</span>
                <span class="result-value" id="totalCost">AED 0</span>
              </div>
            </div>
            
            <div class="effective-apr">
              <span>Effective APR: <strong id="effectiveApr">0%</strong></span>
            </div>
          </div>
        </div>

        <!-- Step 3: Confirmation -->
        <div id="confirmationStep" class="term-loan-step" hidden>
          <h4>Confirm Your Term Loan</h4>
          <div class="confirmation-summary">
            <div class="summary-header">
              <h5>Loan Summary</h5>
            </div>
            <div class="summary-details">
              <div class="summary-row">
                <span>Loan Amount:</span>
                <span id="confirmAmount">AED 0</span>
              </div>
              <div class="summary-row">
                <span>Term:</span>
                <span id="confirmTerm">0 months</span>
              </div>
              <div class="summary-row">
                <span>Monthly Payment:</span>
                <span id="confirmEmi">AED 0</span>
              </div>
              <div class="summary-row">
                <span>Total Interest:</span>
                <span id="confirmInterest">AED 0</span>
              </div>
              <div class="summary-row">
                <span>Processing Fee:</span>
                <span id="confirmProcessingFee">AED 0</span>
              </div>
              <div class="summary-row total">
                <span>Total Amount to Pay:</span>
                <span id="confirmTotal">AED 0</span>
              </div>
            </div>
            
            <div class="terms-acceptance">
              <label class="checkbox-wrapper">
                <input type="checkbox" id="acceptTerms" required>
                <span class="checkmark"></span>
                I agree to the <a href="#" target="_blank">Terms and Conditions</a> and <a href="#" target="_blank">Loan Agreement</a>
              </label>
            </div>
          </div>
        </div>

        <!-- Modal Actions -->
        <div class="modal-actions">
          <button type="button" class="btn-outline" id="termLoanPrev" hidden>Previous</button>
          <button type="button" class="btn-primary" id="termLoanNext">Next</button>
          <button type="button" class="btn-success" id="confirmTermLoan" hidden>Confirm Loan</button>
          <button type="button" class="btn-outline" id="cancelTermLoan">Cancel</button>
        </div>

      </div>
    </div>
  </div>

  <script src="js/main.js"></script>
  <script src="js/term-loan.js"></script>
  <script src="js/credit-line.js"></script>
  <script src="js/auto-sweep-benefits.js"></script>
</body>
</html>
