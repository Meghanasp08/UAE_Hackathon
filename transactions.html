<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Transactions - Smart Credit</title>
  <link rel="stylesheet" href="css/style.css"/>
  <link rel="stylesheet" href="css/carbon-reduction.css"/>
  <script>
    // Redirect to login if not authenticated
    (function() {
      const token = localStorage.getItem('authToken');
      const loginTime = localStorage.getItem('loginTime');
      
      if (!token || !loginTime) {
        window.location.href = 'login.html';
        return;
      }
      
      // Check session expiry (24 hours)
      const sessionDuration = 24 * 60 * 60 * 1000;
      const elapsed = Date.now() - parseInt(loginTime);
      
      if (elapsed > sessionDuration) {
        localStorage.removeItem('authToken');
        localStorage.removeItem('userInfo');
        localStorage.removeItem('loginTime');
        window.location.href = 'login.html';
      }
    })();
  </script>
</head>
<body>
  <header class="topbar">
    <div class="brand">
      <img src="assets/shukria-logo.png" alt="Shukria Logo" class="logo" onerror="this.style.display='none'"/>
    </div>
    <nav class="nav-links">
      <a href="index.html" class="nav-link" title="Dashboard" aria-label="Dashboard">
        <div class="nav-item">
          <img src="assets/nav-dashboard.svg" alt="Dashboard" style="height:28px;width:28px;"/>
          <span class="nav-label">Dashboard</span>
        </div>
      </a>
      <a href="credit-line.php" class="nav-link" title="Credit Line" aria-label="Credit Line">
        <div class="nav-item">
          <img src="assets/nav-credit-line.svg" alt="Credit Line" style="height:28px;width:28px;"/>
          <span class="nav-label">Credit Line</span>
        </div>
      </a>
      <a href="apply.html" class="nav-link" title="Apply" aria-label="Apply">
        <div class="nav-item">
          <img src="assets/nav-apply.svg" alt="Apply" style="height:28px;width:28px;"/>
          <span class="nav-label">Apply</span>
        </div>
      </a>
      <a href="accounts.php" class="nav-link" title="Accounts" aria-label="Accounts">
        <div class="nav-item">
          <img src="assets/nav-transactions.svg" alt="Accounts" style="height:28px;width:28px;"/>
          <span class="nav-label">Accounts</span>
        </div>
      </a>
      <a href="transactions.html" class="nav-link active" title="Transactions" aria-label="Transactions">
        <div class="nav-item">
          <img src="assets/nav-transactions.svg" alt="Transactions" style="height:28px;width:28px;"/>
          <span class="nav-label">Transactions</span>
        </div>
      </a>
    </nav>
    <div class="user-section">
      <div class="user">Hello, Priya Sharma</div>
      <button class="logout-btn" id="logoutBtn" onclick="if(typeof logout === 'function') logout();" title="Logout">âœ]</button>
    </div>
  </header>

  <main class="container">
    <section class="transactions-header">
      <h2>Transaction Statement</h2>
      <p class="subtitle">View and filter your credit line activity</p>
    </section>

    <!-- Summary Cards -->
    <div class="transaction-summary">
      <div class="summary-card">
        <span class="summary-label">Total Spent</span>
        <span class="summary-value">AED 2,750</span>
        <span class="summary-period">This month</span>
      </div>
      <div class="summary-card">
        <span class="summary-label">Transactions</span>
        <span class="summary-value">23</span>
        <span class="summary-period">This month</span>
      </div>
      <div class="summary-card green">
        <span class="summary-label">Low Carbon</span>
        <span class="summary-value">8</span>
        <span class="summary-period">Eco-friendly purchases</span>
      </div>
    </div>

    <!-- Tab Navigation -->
    <div class="tabs-container">
      <div class="tabs-nav">
        <button class="tab-btn active" data-tab="all">
          <span class="tab-icon">ğŸ“Š</span>
          <span>All Transactions</span>
          <span class="tab-badge" id="allCount">0</span>
        </button>
        
        <button class="tab-btn" data-tab="bnpl">
          <span class="tab-icon">ğŸ”„</span>
          <span>BNPL Plans</span>
          <span class="tab-badge" id="bnplCount">0</span>
        </button>
        
        <button class="tab-btn" data-tab="termloans">
          <span class="tab-icon">ğŸ“ˆ</span>
          <span>Term Loans</span>
          <span class="tab-badge" id="termLoansCount">0</span>
        </button>
        
        <button class="tab-btn" data-tab="emi">
          <span class="tab-icon">ğŸ’³</span>
          <span>EMI Payments</span>
          <span class="tab-badge" id="emiCount">0</span>
        </button>
      </div>
    </div>

    <!-- Tab 1: All Transactions -->
    <div id="allTransactionsTab" class="tab-content active">

    <!-- Transactions List -->
    <section class="transactions-list">
      <div class="transaction-item" data-id="1" data-carbon="low">
        <div class="transaction-icon">ğŸ”‹</div>
        <div class="transaction-details">
          <div class="transaction-main">
            <span class="merchant">DEWA - EV Charging</span>
            <span class="amount">-AED 45.00</span>
          </div>
          <div class="transaction-meta">
            <span class="date">Nov 5, 2025 Â· 14:30</span>
            <span class="category">Utilities</span>
            <span class="esg-badge low">ğŸŒ± Low Carbon</span>
          </div>
        </div>
        <button class="bnpl-btn" style="display:none;" data-bnpl="true">Convert to BNPL</button>
        <button class="transaction-expand" aria-label="View details">â€º</button>
      </div>

      <div class="transaction-item" data-id="2" data-carbon="medium">
        <div class="transaction-icon">ğŸ›’</div>
        <div class="transaction-details">
          <div class="transaction-main">
            <span class="merchant">Carrefour Supermarket</span>
            <span class="amount">-AED 230.00</span>
          </div>
          <div class="transaction-meta">
            <span class="date">Nov 4, 2025 Â· 18:45</span>
            <span class="category">Food & Dining</span>
            <span class="esg-badge medium">Medium Impact</span>
          </div>
        </div>
        <button class="transaction-expand" aria-label="View details">â€º</button>
      </div>

      <div class="transaction-item" data-id="3" data-carbon="high">
        <div class="transaction-icon">â›½</div>
        <div class="transaction-details">
          <div class="transaction-main">
            <span class="merchant">ENOC Fuel Station</span>
            <span class="amount">-AED 120.00</span>
          </div>
          <div class="transaction-meta">
            <span class="date">Nov 3, 2025 Â· 08:15</span>
            <span class="category">Transport</span>
            <span class="esg-badge high">High Carbon</span>
          </div>
        </div>
        <button class="transaction-expand" aria-label="View details">â€º</button>
      </div>

      <div class="transaction-item" data-id="4" data-carbon="low">
        <div class="transaction-icon">ğŸš‡</div>
        <div class="transaction-details">
          <div class="transaction-main">
            <span class="merchant">Dubai Metro - Nol Card</span>
            <span class="amount">-AED 25.00</span>
          </div>
          <div class="transaction-meta">
            <span class="date">Nov 3, 2025 Â· 07:30</span>
            <span class="category">Transport</span>
            <span class="esg-badge low">ğŸŒ± Low Carbon</span>
          </div>
        </div>
        <button class="transaction-expand" aria-label="View details">â€º</button>
      </div>

      <div class="transaction-item" data-id="5" data-carbon="medium">
        <div class="transaction-icon">ğŸ•</div>
        <div class="transaction-details">
          <div class="transaction-main">
            <span class="merchant">Pizza Hut - Dubai Mall</span>
            <span class="amount">-AED 85.00</span>
          </div>
          <div class="transaction-meta">
            <span class="date">Nov 2, 2025 Â· 20:00</span>
            <span class="category">Food & Dining</span>
            <span class="esg-badge medium">Medium Impact</span>
          </div>
        </div>
        <button class="transaction-expand" aria-label="View details">â€º</button>
      </div>

      <div class="transaction-item positive" data-id="6">
        <div class="transaction-icon">â†©ï¸</div>
        <div class="transaction-details">
          <div class="transaction-main">
            <span class="merchant">Credit Repayment</span>
            <span class="amount positive">+AED 500.00</span>
          </div>
          <div class="transaction-meta">
            <span class="date">Nov 1, 2025 Â· 10:00</span>
            <span class="category">Payment</span>
          </div>
        </div>
        <button class="transaction-expand" aria-label="View details">â€º</button>
      </div>

      <div class="transaction-item" data-id="7" data-carbon="medium">
        <div class="transaction-icon">ğŸ’Š</div>
        <div class="transaction-details">
          <div class="transaction-main">
            <span class="merchant">Life Pharmacy</span>
            <span class="amount">-AED 145.00</span>
          </div>
          <div class="transaction-meta">
            <span class="date">Oct 31, 2025 Â· 16:20</span>
            <span class="category">Health</span>
            <span class="esg-badge medium">Medium Impact</span>
          </div>
        </div>
        <button class="transaction-expand" aria-label="View details">â€º</button>
      </div>

      <div class="transaction-item" data-id="8" data-carbon="low">
        <div class="transaction-icon">ğŸŒ¿</div>
        <div class="transaction-details">
          <div class="transaction-main">
            <span class="merchant">Organic Foods & Cafe</span>
            <span class="amount">-AED 95.00</span>
          </div>
          <div class="transaction-meta">
            <span class="date">Oct 30, 2025 Â· 12:30</span>
            <span class="category">Food & Dining</span>
            <span class="esg-badge low">ğŸŒ± Low Carbon</span>
          </div>
        </div>
        <button class="transaction-expand" aria-label="View details">â€º</button>
      </div>
    </section>

    <div class="load-more">
      <button class="btn-outline" id="loadMore">Load More Transactions</button>
    </div>
    </div>
    <!-- End Tab 1: All Transactions -->

    <!-- Tab 2: BNPL Plans -->
    <div id="bnplTab" class="tab-content">
      <section class="bnpl-plans-section" id="bnplPlansSection">
        <div class="section-header">
          <h3>ğŸ”„ Active BNPL Plans</h3>
          <p class="subtitle">Manage your installment payments</p>
        </div>
        <div class="bnpl-plans-list" id="bnplPlansList">
          <!-- BNPL plans will be dynamically generated here -->
        </div>
      </section>
    </div>
    <!-- End Tab 2: BNPL Plans -->

    <!-- Tab 3: Term Loans -->
    <div id="termLoansTab" class="tab-content">
      <section class="term-loans-section" id="termLoansSection">
        <div class="section-header">
          <h3>ğŸ“ˆ Active Term Loans</h3>
          <p class="subtitle">Manage your term loan repayments</p>
        </div>
        <div class="term-loans-list" id="termLoansList">
          <!-- Term loans will be dynamically generated here -->
        </div>
      </section>
    </div>
    <!-- End Tab 3: Term Loans -->

    <!-- Tab 4: EMI Payments -->
    <div id="emiTab" class="tab-content">
      <section class="emi-payments-section" id="emiPaymentsSection">
        <div class="section-header">
          <h3>ğŸ’³ Upcoming EMI Payments</h3>
          <p class="subtitle">Your payment schedule across all plans</p>
        </div>
        <div class="emi-payments-list" id="emiPaymentsList">
          <!-- EMI payments will be dynamically generated here -->
        </div>
      </section>
    </div>
    <!-- End Tab 4: EMI Payments -->
  </main>

  <!-- Voice feedback live region -->
  <div id="voiceFeedback" class="sr-only" role="status" aria-live="polite" aria-atomic="true"></div>

  <!-- Transaction Detail Modal -->
  <div id="detailModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="detailTitle" hidden>
    <div class="modal-content">
      <div class="modal-header">
        <h3 id="detailTitle">Transaction Details</h3>
        <button class="modal-close" aria-label="Close modal">&times;</button>
      </div>
      <div class="modal-body">
        <div id="transactionDetail" class="transaction-detail">
          <!-- Dynamic content -->
        </div>
        <div class="modal-actions">
          <button class="btn-outline" id="voiceRead">ğŸ”Š Read Aloud</button>
          <button class="btn-outline" id="downloadReceipt">Download Receipt</button>
        </div>
      </div>
    </div>
  </div>

  <!-- BNPL Plan Modal -->
  <div id="bnplModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="bnplTitle" hidden>
    <div class="modal-content">
      <div class="modal-header">
        <h3 id="bnplTitle">Convert to Installments</h3>
        <button class="modal-close" id="closeBnplModal" aria-label="Close modal">&times;</button>
      </div>
      <div class="modal-body">
        <div id="bnplPlanDetail" class="bnpl-plan-detail">
          <!-- BNPL plan details will be injected here -->
        </div>
        <div class="modal-actions">
          <button class="btn-primary" id="confirmBnplPlan">Confirm & Start Plan</button>
        </div>
      </div>
    </div>
  </div>

  <link rel="stylesheet" href="css/chatbot.css"/>
  <script src="js/carbon-points.js"></script>
  <script src="js/main.js"></script>
  <script src="js/term-loan.js"></script>
  <script src="js/transactions.js"></script>
  <script src="js/ai-chatbot.js"></script>
</body>
</html>
